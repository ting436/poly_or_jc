<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Step Form</title>
    <script>

        document.getElementById("form1").style.display = "block";

        function hideSubmitButton(formId) {
            document.querySelector(`#${formId} button[type="button"]`).style.display = "none";
        }

        function saveSelections() {
            let selectedOptions = [];
            document.querySelectorAll("input[name='key_considerations']:checked").forEach((checkbox) => {
                selectedOptions.push(checkbox.value);
            });

            // Store selected options in sessionStorage
            sessionStorage.setItem("selectedOptions", JSON.stringify(selectedOptions));

            document.getElementById("form2").style.display = "block";

            populateRankingOptions();
        }

        function populateRankingOptions() {
            let selectedOptions = JSON.parse(sessionStorage.getItem("selectedOptions")) || [];
            let rankingDiv = document.getElementById("rankingOptions");

            rankingDiv.innerHTML = "";

            selectedOptions.forEach(option => {
                let label = document.createElement("label");
                label.innerHTML = option.replace(/_/g, " ") + ": ";

                let select = document.createElement("select");
                select.name = "ranking_" + option;

                for (let i = 1; i <= selectedOptions.length; i++) {
                    let optionElement = document.createElement("option");
                    optionElement.value = i;
                    optionElement.textContent = i;
                    select.appendChild(optionElement);
                }

                rankingDiv.appendChild(label);
                rankingDiv.appendChild(select);
                rankingDiv.appendChild(document.createElement("br"));
            });
        }

        function saveRanking() {
            let rankings = {};
            document.querySelectorAll("#form2 select").forEach(select => {
                rankings[select.name] = select.value;
            });

            sessionStorage.setItem("rankings", JSON.stringify(rankings));

            document.getElementById("form3").style.display = "block";

            populateShortAnswerQuestions();
        }

        function populateShortAnswerQuestions() {
            let rankings = JSON.parse(sessionStorage.getItem("rankings")) || {};
            let shortAnswerDiv = document.getElementById("shortAnswerQuestions");

            shortAnswerDiv.innerHTML = "";

            Object.keys(rankings).sort((a, b) => rankings[a] - rankings[b]).forEach(option => {
                let label = document.createElement("label");
                label.innerHTML = option.replace("ranking_", "").replace(/_/g, " ") + ": ";

                let textArea = document.createElement("textarea");
                textArea.name = "explanation_" + option.replace("ranking_", "");
                textArea.rows = 2;
                textArea.cols = 50;
                textArea.placeholder = "Why did you rank this choice like this?";

                shortAnswerDiv.appendChild(label);
                shortAnswerDiv.appendChild(document.createElement("br"));
                shortAnswerDiv.appendChild(textArea);
                shortAnswerDiv.appendChild(document.createElement("br"));
                shortAnswerDiv.appendChild(document.createElement("br"));
            });
        }
    </script>
</head>
<body>

    <!-- First Page: Selection -->
    <form id="form1">
        <h2>What are the key considerations you have in choosing poly or JC?</h2>

        <label><input type="checkbox" name="key_considerations" id="fees" value="School Fees"> School Fees <br></label>
        <label><input type="checkbox" name="key_considerations" id="location" value="Location"> Location <br></label>
        <label><input type="checkbox" name="key_considerations" id="intern_opp" value="Internship Opportunities"> Internship Opportunities <br></label>
        <label><input type="checkbox" name="key_considerations" id="stress" value="Stress Level"> Stress Level <br></label>
        <label><input type="checkbox" name="key_considerations" id="career_opp" value="Career Opportunities"> Career Opportunities <br></label>
        <label><input type="checkbox" name="key_considerations" id="school_env" value="School Environment (e.g., large student body)"> School Environment (e.g., large student body) <br></label>
        <label><input type="checkbox" name="key_considerations" id="extracurricular" value="CCA/Interest Groups"> CCA/Interest Groups <br></label>

        <button type="button" onclick="hideSubmitButton('form1'); saveSelections()">Next</button>
    </form>

    <!-- Second Page: Ranking -->
    <form id="form2" style="display: none;">
        <h2>Rank Your Considerations</h2>
        <div id="rankingOptions"></div>

        <button type="button" onclick="hideSubmitButton('form2'); saveRanking()">Next</button>
    </form>

    <!-- Third Page: Short Answer Questions -->
    <form id="form3" action="pipeline.py" method="post" style="display: none;">
        <h2>Explain Your Rankings</h2>
        <div id="shortAnswerQuestions"></div>
        <div id="personalQuestions">
            <label>What are your current interests?/ What career paths are you considering for your future? <br>
                <textarea name="interests" rows="2" cols="50" placeholder="Your answer here..."></textarea>
            </label><br><br>
        
            <label>What is your L1R5 Score? <br>
                <textarea name="l1r5" rows="2" cols="50" placeholder="Your answer here..."></textarea>
            </label><br><br>
        
            <label>What are your strengths/skills? <br>
                <textarea name="strengths" rows="2" cols="50" placeholder="Your answer here..."></textarea>
            </label><br><br>
        
            <label>Do you prefer academic, theory-based learning or hands-on, practical experience? <br>
                <textarea name="learning_style" rows="2" cols="50" placeholder="Your answer here..."></textarea>
            </label><br><br>
        
            <label>Are you focused on entering a specific industry (e.g., design, engineering, business) or do you want a more general university education? <br>
                <textarea name="education_focus" rows="2" cols="50" placeholder="Your answer here..."></textarea>
            </label><br><br>
        </div>

        <button type="submit">Submit</button>
    </form>

</body>
</html>
